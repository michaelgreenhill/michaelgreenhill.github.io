<!DOCTYPE html>
<html lang="en">
  <head>

    <meta charset="utf-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge"/>
<meta name="HandheldFriendly" content="True"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="generator" content="11ty"/>
<meta name="referrer" content="no-referrer-when-downgrade"/>
<meta name="description" content="IT and Photography"/>

<title>Making my homelab smarter - Part 3</title>

<link rel="stylesheet" type="text/css" href="/css/screen.css?v=ea37315572b4688ec79439d24377c5a1">
<link rel="stylesheet" type="text/css" href="/css/custom.css?v=7a88a16b41070bc778b11cf209426543">
<link rel="shortcut icon" href="/favicon.ico?v=1429123ad6a04f8249a06b6767130736" type="image/x-icon">

<link rel="alternate" type="application/atom+xml" title="" href="/feed.xml?v=6665236f9459354cefc0f8a0ec2552ca">



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-97297631-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-97297631-1');
    </script>

    <link rel="canonical" href="https://michaelgreenhill.net/making-my-homelab-smarter-part-3/"/>

    <meta property="og:site_name" content="Michael Greenhill"/>
    <meta property="og:type" content="article"/>
    <meta property="og:title" content="Making my homelab smarter - Part 3"/>
    <meta property="og:description" content="Compu-Global-Hyper-Mega-Net"/>
    <meta property="og:url" content="https://michaelgreenhill.net/making-my-homelab-smarter-part-3/"/>
    <meta property="og:image" content="/images/1_F5iT46roUJaBhAOV3fJNjA.png"/>
    <meta property="article:published_time" content="2020-02-22T04:58:36.000Z"/>
    <meta property="article:modified_time" content="2020-02-22T04:58:36.000Z"/>
    <meta property="article:tag" content="it"/>
    <meta property="article:tag" content="ddos"/>
    <meta property="article:tag" content="nginx"/>

    <meta property="article:publisher" content="https://facebook.com/aspect19"/>
    <meta name="twitter:card" content="summary_large_image"/>
    <meta name="twitter:title" content="Making my homelab smarter - Part 3"/>
    <meta name="twitter:description" content="Compu-Global-Hyper-Mega-Net"/>
    <meta name="twitter:url" content="https://michaelgreenhill.net/making-my-homelab-smarter-part-3/"/>
    <meta name="twitter:image" content="/images/1_F5iT46roUJaBhAOV3fJNjA.png"/>
    <meta name="twitter:label1" content="Written by"/>
    <meta name="twitter:data1" content=""/>
    <meta name="twitter:label2" content="Filed under"/>
    <meta name="twitter:data2" content="it, ddos, nginx"/>
    <meta property="og:image:width" content="1280"/>
    <meta property="og:image:height" content="919"/>

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "publisher": {
          "@type": "Organization",
          "name": "",
          "logo": {
            "@type": "ImageObject",
            "url": "https://michaelgreenhill.net/favicon.ico",
            "width": 48,
            "height": 48
          }
        },
        "author": {
          "@type": "Person",
          "name": "",
          "image": {
            "@type": "ImageObject",
            "url": "",
            "width": 500,
            "height": 500
          },
          "url": "https://michaelgreenhill.net/author/michael/",
          "sameAs": []
        },
        "headline": "Making my homelab smarter - Part 3",
        "url": "https://michaelgreenhill.net/making-my-homelab-smarter-part-3/",
        "datePublished": "2020-02-22T04:58:36.000Z",
        "dateModified": "2020-02-22T04:58:36.000Z",
        "image": {
          "@type": "ImageObject",
          "url": "/images/1_F5iT46roUJaBhAOV3fJNjA.png",
          "width": 1280,
          "height": 919
        },
        "keywords": "it, ddos, nginx",
        "description": "Compu-Global-Hyper-Mega-Net",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://michaelgreenhill.net/"
        }
      }
    </script>

  </head>
  <body class="post-template">

    <div class="site-wrapper">

      <header class="site-header">
        <div class="outer site-nav-main">
          <div class="inner">
            

<nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
            <a class="site-nav-logo" href="/">Michael Greenhill</a>
            <div class="site-nav-content">
                <ul class="nav" role="menu">
                    <li class="nav-home " role="menuitem">
                        <a href="/">Home</a>
                    </li>
                    <li class="nav-home " role="menuitem">
                        <a href="/archives/">Archives</a>
                    </li>
                    <li class="nav-home " role="menuitem">
                        <a href="/tags/">Tags</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            <a class="social-link social-link-fb" href="https://facebook.com/aspect19" title="Facebook" target="_blank" rel="noopener">
                <svg viewbox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 0c8.837 0 16 7.163 16 16s-7.163 16-16 16S0 24.837 0 16 7.163 0 16 0zm5.204 4.911h-3.546c-2.103 0-4.443.885-4.443 3.934.01 1.062 0 2.08 0 3.225h-2.433v3.872h2.509v11.147h4.61v-11.22h3.042l.275-3.81h-3.397s.007-1.695 0-2.187c0-1.205 1.253-1.136 1.329-1.136h2.054V4.911z"></path>
                </svg>
            </a>
        </div>
    </div>
</nav>
          </div>
        </div>
      </header>

      <main id="site-main" class="site-main outer">
        <div class="inner">
          <article class="post-full post">
            <section class="post-full-content">
              <div class="post-header">
                <h1>Making my homelab smarter - Part 3</h1>

                
                <ol reversed class="taglist" style="counter-reset: start-from 5">




  <li>
    <a href="/tags/homelab" class="taglist-link">homelab</a>
  </li>



  <li>
    <a href="/tags/it" class="taglist-link">it</a>
  </li>



  <li>
    <a href="/tags/ipv6" class="taglist-link">ipv6</a>
  </li>


</ol>
                <span class="reading-time">About 3 min reading time</span>

              </div>

              
              <div class="heroimage"><img src="/images/1_F5iT46roUJaBhAOV3fJNjA.png"></div>
              

              <div class="post-content">
                <p class="subtitle">Compu-Global-Hyper-Mega-Net</p>
                
                <aside class="post-aside">
                  <strong>Contents</strong>
                  <nav class="toc"><ol><li><a href="#the-big%2C-scary%2C-ipv6-monster">The big, scary, IPv6 monster</a></li><li><a href="#taming%2C-understanding%2C-and-eventually%2C-loving-the-monster">Taming, understanding, and eventually, loving the monster</a></li><li><a href="#once-again%2C-get-your-firewall-sorted-out">Once again, get your firewall sorted out</a></li><li><a href="#glossary">Glossary</a></li></ol></nav>
                </aside>
                <p>Let’s recap. Back in <a href="/making-my-homelab-smarter-part-1">Part 1</a>, I had a proper grumble about ADSL and routers. In <a href="/making-my-homelab-smarter-part-2">Part 2</a> we enjoyed a good chat about multi-WAN (load balancing, failover) and policy-based routing.</p>
<h2 id="the-big%2C-scary%2C-ipv6-monster">The big, scary, IPv6 monster <a class="anchor-link" href="#the-big%2C-scary%2C-ipv6-monster">#</a></h2>
<p>For those who don’t know, we’re out of IPv4 addresses. Globally. They’re all gone. They even looked behind the fridge for more. So, it’s time to embrace IPv6 (so far as your ISP will allow it!).</p>
<p>My ISP, Internode, gives me a delegated /56 block of addresses. “What does /56 mean?” I hear you all cry? Basically, instead of getting a single public IP address (as was typically the case with IPv4), I have <strong>4,722,366,482,869,645,213,696</strong> publicly-routable addresses to play with.</p>
<p>It’s a visually offensive number. Unfathomably large. I don’t even know which “illion” that comes out to. I tried to frame it as the number of seconds in a century, and it still came out to be a ridiculous number of centuries.</p>
<p>So while some of us are used to the IPv4 dotted-quad notation (192.168.1.1 with a subnet mask of 255.255.255.0), IPv6 goes a bit crazy and calls it the “canonical textual representation format” — one of those terms that just makes me feel warm and fuzzy inside — which looks something like 2001:db8:1234:0000:0000:0000:0000:0001. Thankfully, that can be shortened to 2001:db8:1234::1. For some quality bedtime reading, I suggest checking out the <a href="https://en.wikipedia.org/wiki/IPv6_address">Wikipedia article on IPv6</a>.</p>
<h2 id="taming%2C-understanding%2C-and-eventually%2C-loving-the-monster">Taming, understanding, and eventually, loving the monster <a class="anchor-link" href="#taming%2C-understanding%2C-and-eventually%2C-loving-the-monster">#</a></h2>
<p>Thanks to some epic sleuthing (aka Google) I’ve got the following recipe to get IPv6 working both at the edge of and inside my network.</p>
<p><em>Disclaimer: IPv6 is <strong>globally routable!</strong> The concept of NAT, and the security-through-obscurity that it provides, does not exist in IPv6. Any IPv6 addresses that you issue to your LAN computers can be reached from the internet — unless you have a good firewall. I take no responsibility if you get all virus’d up.</em></p>
<p>The first thing we need to do is set our WAN interface’s IPv6 configuration to <strong>DHCP6</strong>. This will get a /64 address from our ISP and provide a path out to the internet.</p>
<p><img src="/images/1_KIOqbpN_DiUfS5Xk98PrqA.png" alt="So far, so good"></p>
<p>The trick here is to use the IPv4 interface (our PPPoE ADSL tunnel) to request our IPv6 connectivity.</p>
<p><img src="/images/1_Sw0YDnf5gPJSbIjM1VoGoA.png" alt="The 6 in IPv6 stands for “god damn enormous”"></p>
<p>Save and apply the changes, then head over to the LAN interface. Here’s where it gets interesting. Set the IPv6 configuration type to <strong>Track Interface…</strong></p>
<p><img src="/images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.png" alt="&quot;Track Interface&quot; is what used to happen when I passed out while running. Say that one out loud."></p>
<p>…then scroll down to the IPv6 Track Interface section, and set the <strong>IPv6 Interface</strong> to <strong>WAN</strong> and the <strong>Prefix ID</strong> to <strong>0</strong>.</p>
<p><img src="/images/1_PqucCadu7X-4ZAcNumGFhQ.png" alt="The Prefix ID may not be 0 — this may require some tweaking and contact with your ISP."></p>
<p>Save and apply, then head to the <strong>Status &gt; Interfaces</strong> page. This will show you your WAN IPv6, your LAN IPv6, and any IPv6 Link Local addresses.</p>
<p><img src="/images/1_hZgDYaeBrvezuxnw4ozFAg.png" alt="Magic!"></p>
<p>The next step, of course, is configuring pfSense to issue IPv6 addresses to machines on your network. Head on over to Services &gt; DHCPv6 Server &amp; RA.</p>
<p>While it looks daunting there’s actually very little that needs configuring here:</p>
<ul>
<li>Enable DHCPv6 server on interface LAN</li>
<li>Set the range from ::1000 to ::2000 (or whatever size you want)</li>
<li>Set the DNS servers</li>
<li>Save</li>
</ul>
<p><img src="/images/1_yMMvcM4ECmFpVGPRbYqjUA.png" alt="I’m using the ::1 address from my /56 subnet as the DNS server — i.e., the pfSense router."></p>
<p>The final step is to configure the <strong>Router Advertisements</strong> section. You’ll have noticed that the DHCPv6 configuration doesn’t have an option to specify the default gateway — IPv6 does away with the concept of static gateways and, using the <a href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> (NDP), announces to the network what the router (aka default gateway) is.</p>
<p><img src="/images/1_OXaSP4H123fBKGev11y0nQ.png" alt="Probably should caption this, eh"></p>
<p>Lastly, at the bottom of the page, check the checkbox next to <strong>Use same settings as DHCPv6 server</strong>, and click <strong>Save</strong></p>
<p><img src="/images/1_DcjQ3vTDFE-k7Q_PAatOPw.png" alt="Hey, presto! DHCPv6."></p>
<p><img src="/images/1_F5iT46roUJaBhAOV3fJNjA.png" alt="Spookyboi numbers"></p>
<hr>
<h2 id="once-again%2C-get-your-firewall-sorted-out">Once again, get your firewall sorted out <a class="anchor-link" href="#once-again%2C-get-your-firewall-sorted-out">#</a></h2>
<p>pfSense has a deny-by-default approach to firewall rules. Unless a rule exists to allow the traffic, it’s blocked. This is good!</p>
<p>Unless you’ve a really good reason for allowing traffic into your network on the WAN interface, <strong>don’t</strong>. Before you get IPv6 configured, take a few seconds to verify you don’t have a cheeky “allow-all” rule on your WAN interface.</p>
<hr>
<h2 id="glossary">Glossary <a class="anchor-link" href="#glossary">#</a></h2>
<p>Someone pointed out that a glossary of terms would be useful. So, Guy, here ya go:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/IPv6">IPv6:</a> the 6th version of the Internet Protocol.</li>
<li>ISP: Internet Service Provider. Telstra, Verizon, BT, etc.</li>
<li><a href="https://en.wikipedia.org/wiki/Subnetwork">Subnet mask</a>: a method used to divide an IP address range.</li>
<li><a href="https://en.wikipedia.org/wiki/Network_address_translation">NAT: Network Address Translation</a>. Wot allows millions of 192.168.168.1 home routers to coexist on the internet without it literally erupting into flames.</li>
<li><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">/64, /56: Classless Inter-Domain Routing network sizes</a>. A way of expressing the division of IP address ranges into smaller chunks.</li>
<li><a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCPv6</a>: The IPv6 version of the well-loved Dynamic Host Configuration Protocol. Dynamically issues an IP address to your computer from a larger pool of addresses.</li>
<li><a href="https://en.wikipedia.org/wiki/Link-local_address">Link Local</a>: A method used by IPv4 and IPv6 to self-issue IP addresses in the absence of DHCP or a statically-configured address.</li>
</ul>

              </div>
            </section>
          </article>
        </div>
      </main>

      <aside class="read-next outer"></aside>

      

    <footer class="site-footer outer"></footer>

    </div>
  </body>
</html>