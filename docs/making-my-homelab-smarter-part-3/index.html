<!DOCTYPE html><html lang="en"><head>

    <meta charset="utf-8">

<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="11ty">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="description" content="IT and Photography">

<title>Making my homelab smarter - Part 3</title>

<link rel="preconnect" href="https://www.google-analytics.com/">
<link rel="preconnect" href="https://s3-ap-southeast-2.amazonaws.com/">


<link rel="stylesheet" type="text/css" href="/css/screen.css?v=ea37315572b4688ec79439d24377c5a1">
<link rel="stylesheet" type="text/css" href="/css/custom.css?v=3b050b1981d6bddb3f117450649cc192">
<link rel="stylesheet" type="text/css" href="/css/prism-dracula.css?v=4520dcfe35ffae83c7c2e6cb6081528d">
<link rel="shortcut icon" href="/favicon.ico?v=1429123ad6a04f8249a06b6767130736" type="image/x-icon">

<link rel="alternate" type="application/atom+xml" title="Michael Greenhill" href="/feed.xml?v=907495db5f2848ae9a89ad7071c46789">



    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=UA-97297631-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());

      gtag('config', 'UA-97297631-1');
    </script>

<script>
    if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/service-worker.js");
    }
</script> 

    <link rel="canonical" href="https://michaelgreenhill.net/making-my-homelab-smarter-part-3/">

    <meta property="og:site_name" content="Michael Greenhill">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Making my homelab smarter - Part 3">
    <meta property="og:description" content="Compu-Global-Hyper-Mega-Net">
    <meta property="og:url" content="https://michaelgreenhill.net/making-my-homelab-smarter-part-3/">
    <meta property="og:image" content="/images/1_F5iT46roUJaBhAOV3fJNjA.png">
    <meta property="article:published_time" content="2020-01-08T11:00:00+11:00">
    <meta property="article:modified_time" content="2020-01-08T11:00:00+11:00">

    
    
    
    
      <meta property="article:tag" content="homelab">
    
    
    
      <meta property="article:tag" content="it">
    
    
    
      <meta property="article:tag" content="ipv6">
    
    

    <meta property="article:publisher" content="https://facebook.com/aspect19">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Making my homelab smarter - Part 3">
    <meta name="twitter:description" content="Compu-Global-Hyper-Mega-Net">
    <meta name="twitter:url" content="https://michaelgreenhill.net/making-my-homelab-smarter-part-3/">
    <meta name="twitter:image" content="/images/1_F5iT46roUJaBhAOV3fJNjA.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Michael Greenhill">
    <meta name="twitter:label2" content="Filed under">
    <meta name="twitter:data2" content="it, ddos, nginx">

    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "Article",
        "publisher": {
          "@type": "Organization",
          "name": "Michael Greenhill",
          "logo": {
            "@type": "ImageObject",
            "url": "https://michaelgreenhill.net/favicon.ico",
            "width": 48,
            "height": 48
          }
        },
        "author": {
          "@type": "Person",
          "name": "Michael Greenhill",
          "image": {
            "@type": "ImageObject",
            "url": "https://s3-ap-southeast-2.amazonaws.com/michaelgreenhill-net/cdn/2020/02/download.png",
            "width": 500,
            "height": 500
          },
          "url": "https://michaelgreenhill.net/",
          "sameAs": []
        },
        "headline": "Making my homelab smarter - Part 3",
        "url": "https://michaelgreenhill.net/making-my-homelab-smarter-part-3/",
        "datePublished": "2020-01-08T11:00:00+11:00",
        "dateModified": "2020-01-08T11:00:00+11:00",
        "image": {
          "@type": "ImageObject",
          "url": "/images/1_F5iT46roUJaBhAOV3fJNjA.png"
        },
        "keywords": "post,homelab,it,ipv6",
        "description": "Compu-Global-Hyper-Mega-Net",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://michaelgreenhill.net/"
        }
      }
    </script>

  </head>
  <body class="post-template">

    <div class="site-wrapper">

      <header class="site-header">
        <div class="outer site-nav-main">
          <div class="inner">
            

<nav class="site-nav">
    <div class="site-nav-left-wrapper">
        <div class="site-nav-left">
            <a class="site-nav-logo" href="/">Michael Greenhill</a>
            <div class="site-nav-content">
                <ul class="nav" role="menu">
                    <li class="nav-home " role="menuitem">
                        <a href="/">Home</a>
                    </li>
                    <li class="nav-home " role="menuitem">
                        <a href="/about/">About</a>
                    </li>
                    <li class="nav-home " role="menuitem">
                        <a href="/archives/">Archives</a>
                    </li>
                    <li class="nav-home " role="menuitem">
                        <a href="/tags/">Tags</a>
                    </li>
                </ul>
            </div>
        </div>
    </div>
    <div class="site-nav-right">
        <div class="social-links">
            <a class="social-link social-link-fb" href="https://facebook.com/aspect19" title="Facebook" target="_blank" rel="noopener">
                <svg viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                    <path d="M16 0c8.837 0 16 7.163 16 16s-7.163 16-16 16S0 24.837 0 16 7.163 0 16 0zm5.204 4.911h-3.546c-2.103 0-4.443.885-4.443 3.934.01 1.062 0 2.08 0 3.225h-2.433v3.872h2.509v11.147h4.61v-11.22h3.042l.275-3.81h-3.397s.007-1.695 0-2.187c0-1.205 1.253-1.136 1.329-1.136h2.054V4.911z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
          </div>
        </div>
      </header>

      <main id="site-main" class="site-main outer">
        <div class="inner">
          <article class="post-full post">
            <section class="post-full-content">
              <div class="post-header">
                <h1>Making my homelab smarter - Part 3</h1>

                
                <ol reversed class="taglist" style="counter-reset: start-from 5">




  <li>
    <a href="/tags/homelab" class="taglist-link">homelab</a>
  </li>



  <li>
    <a href="/tags/it" class="taglist-link">it</a>
  </li>



  <li>
    <a href="/tags/ipv6" class="taglist-link">ipv6</a>
  </li>


</ol>
                <span class="reading-time">About 3 min reading time</span>

              </div>

              
              <div class="heroimage" style="background-image: url(/images/1_F5iT46roUJaBhAOV3fJNjA.png);"><div><picture><source srcset="/images/1_F5iT46roUJaBhAOV3fJNjA.510.webp 510w" sizes="100vw" type="image/webp"><source srcset="/images/1_F5iT46roUJaBhAOV3fJNjA.510.png 510w" sizes="100vw" type="image/png"><img src="/images/1_F5iT46roUJaBhAOV3fJNjA.png" height="161" width="510" loading="lazy"></picture></div></div>
              

              <div class="post-content">
                <p class="subtitle">Compu-Global-Hyper-Mega-Net</p>
                
                <aside class="post-aside">
                  <strong>Contents</strong>
                  <nav class="toc"><ol><li><a href="#the-big%2C-scary%2C-ipv6-monster">The big, scary, IPv6 monster</a></li><li><a href="#taming%2C-understanding%2C-and-eventually%2C-loving-the-monster">Taming, understanding, and eventually, loving the monster</a></li><li><a href="#once-again%2C-get-your-firewall-sorted-out">Once again, get your firewall sorted out</a></li><li><a href="#glossary">Glossary</a></li></ol></nav>
                </aside>
                <p>Let&#x2019;s recap. Back in <a href="/making-my-homelab-smarter-part-1">Part 1</a>, I had a proper grumble about ADSL and routers. In <a href="/making-my-homelab-smarter-part-2">Part 2</a> we enjoyed a good chat about multi-WAN (load balancing, failover) and policy-based routing.</p>
<h2 id="the-big%2C-scary%2C-ipv6-monster">The big, scary, IPv6 monster <a class="anchor-link" href="#the-big%2C-scary%2C-ipv6-monster">#</a></h2>
<p>For those who don&#x2019;t know, we&#x2019;re out of IPv4 addresses. Globally. They&#x2019;re all gone. They even looked behind the fridge for more. So, it&#x2019;s time to embrace IPv6 (so far as your ISP will allow it!).</p>
<p>My ISP, Internode, gives me a delegated /56 block of addresses. &#x201C;What does /56 mean?&#x201D; I hear you all cry? Basically, instead of getting a single public IP address (as was typically the case with IPv4), I have <strong>4,722,366,482,869,645,213,696</strong> publicly-routable addresses to play with.</p>
<p>It&#x2019;s a visually offensive number. Unfathomably large. I don&#x2019;t even know which &#x201C;illion&#x201D; that comes out to. I tried to frame it as the number of seconds in a century, and it still came out to be a ridiculous number of centuries.</p>
<p>So while some of us are used to the IPv4 dotted-quad notation (192.168.1.1 with a subnet mask of 255.255.255.0), IPv6 goes a bit crazy and calls it the &#x201C;canonical textual representation format&#x201D; &#x2014; one of those terms that just makes me feel warm and fuzzy inside &#x2014; which looks something like 2001:db8:1234:0000:0000:0000:0000:0001. Thankfully, that can be shortened to 2001:db8:1234::1. For some quality bedtime reading, I suggest checking out the <a href="https://en.wikipedia.org/wiki/IPv6_address">Wikipedia article on IPv6</a>.</p>
<h2 id="taming%2C-understanding%2C-and-eventually%2C-loving-the-monster">Taming, understanding, and eventually, loving the monster <a class="anchor-link" href="#taming%2C-understanding%2C-and-eventually%2C-loving-the-monster">#</a></h2>
<p>Thanks to some epic sleuthing (aka Google) I&#x2019;ve got the following recipe to get IPv6 working both at the edge of and inside my network.</p>
<p><em>Disclaimer: IPv6 is <strong>globally routable!</strong> The concept of NAT, and the security-through-obscurity that it provides, does not exist in IPv6. Any IPv6 addresses that you issue to your LAN computers can be reached from the internet &#x2014; unless you have a good firewall. I take no responsibility if you get all virus&#x2019;d up.</em></p>
<p>The first thing we need to do is set our WAN interface&#x2019;s IPv6 configuration to <strong>DHCP6</strong>. This will get a /64 address from our ISP and provide a path out to the internet.</p>
<p><picture><source srcset="/images/1_KIOqbpN_DiUfS5Xk98PrqA.320.webp 320w, /images/1_KIOqbpN_DiUfS5Xk98PrqA.640.webp 640w, /images/1_KIOqbpN_DiUfS5Xk98PrqA.960.webp 960w, /images/1_KIOqbpN_DiUfS5Xk98PrqA.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_KIOqbpN_DiUfS5Xk98PrqA.320.png 320w, /images/1_KIOqbpN_DiUfS5Xk98PrqA.640.png 640w, /images/1_KIOqbpN_DiUfS5Xk98PrqA.960.png 960w, /images/1_KIOqbpN_DiUfS5Xk98PrqA.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_KIOqbpN_DiUfS5Xk98PrqA.png" alt="So far, so good" height="379" width="1000" loading="lazy"></picture></p>
<p>The trick here is to use the IPv4 interface (our PPPoE ADSL tunnel) to request our IPv6 connectivity.</p>
<p><picture><source srcset="/images/1_Sw0YDnf5gPJSbIjM1VoGoA.320.webp 320w, /images/1_Sw0YDnf5gPJSbIjM1VoGoA.640.webp 640w, /images/1_Sw0YDnf5gPJSbIjM1VoGoA.960.webp 960w, /images/1_Sw0YDnf5gPJSbIjM1VoGoA.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_Sw0YDnf5gPJSbIjM1VoGoA.320.png 320w, /images/1_Sw0YDnf5gPJSbIjM1VoGoA.640.png 640w, /images/1_Sw0YDnf5gPJSbIjM1VoGoA.960.png 960w, /images/1_Sw0YDnf5gPJSbIjM1VoGoA.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_Sw0YDnf5gPJSbIjM1VoGoA.png" alt="The 6 in IPv6 stands for &quot;god damn enormous&quot;" height="307" width="1000" loading="lazy"></picture></p>
<p>Save and apply the changes, then head over to the LAN interface. Here&#x2019;s where it gets interesting. Set the IPv6 configuration type to <strong>Track Interface&#x2026;</strong></p>
<p><picture><source srcset="/images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.320.webp 320w, /images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.640.webp 640w, /images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.960.webp 960w, /images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.320.png 320w, /images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.640.png 640w, /images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.960.png 960w, /images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_86QT4D8YTA-7Y5Sk_Vbt_Q.png" alt="&quot;Track Interface&quot; is what used to happen when I passed out while running. Say that one out loud." height="438" width="1000" loading="lazy"></picture></p>
<p>&#x2026;then scroll down to the IPv6 Track Interface section, and set the <strong>IPv6 Interface</strong> to <strong>WAN</strong> and the <strong>Prefix ID</strong> to <strong>0</strong>.</p>
<p><picture><source srcset="/images/1_PqucCadu7X-4ZAcNumGFhQ.320.webp 320w, /images/1_PqucCadu7X-4ZAcNumGFhQ.640.webp 640w, /images/1_PqucCadu7X-4ZAcNumGFhQ.960.webp 960w, /images/1_PqucCadu7X-4ZAcNumGFhQ.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_PqucCadu7X-4ZAcNumGFhQ.320.png 320w, /images/1_PqucCadu7X-4ZAcNumGFhQ.640.png 640w, /images/1_PqucCadu7X-4ZAcNumGFhQ.960.png 960w, /images/1_PqucCadu7X-4ZAcNumGFhQ.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_PqucCadu7X-4ZAcNumGFhQ.png" alt="The Prefix ID may not be 0 &#x2014; this may require some tweaking and contact with your ISP." height="158" width="1000" loading="lazy"></picture></p>
<p>Save and apply, then head to the <strong>Status &gt; Interfaces</strong> page. This will show you your WAN IPv6, your LAN IPv6, and any IPv6 Link Local addresses.</p>
<p><picture><source srcset="/images/1_hZgDYaeBrvezuxnw4ozFAg.510.webp 510w" sizes="100vw" type="image/webp"><source srcset="/images/1_hZgDYaeBrvezuxnw4ozFAg.510.png 510w" sizes="100vw" type="image/png"><img src="/images/1_hZgDYaeBrvezuxnw4ozFAg.png" alt="Magic!" height="774" width="510" loading="lazy"></picture></p>
<p>The next step, of course, is configuring pfSense to issue IPv6 addresses to machines on your network. Head on over to Services &gt; DHCPv6 Server &amp; RA.</p>
<p>While it looks daunting there&#x2019;s actually very little that needs configuring here:</p>
<ul>
<li>Enable DHCPv6 server on interface LAN</li>
<li>Set the range from ::1000 to ::2000 (or whatever size you want)</li>
<li>Set the DNS servers</li>
<li>Save</li>
</ul>
<p><picture><source srcset="/images/1_yMMvcM4ECmFpVGPRbYqjUA.320.webp 320w, /images/1_yMMvcM4ECmFpVGPRbYqjUA.640.webp 640w, /images/1_yMMvcM4ECmFpVGPRbYqjUA.960.webp 960w, /images/1_yMMvcM4ECmFpVGPRbYqjUA.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_yMMvcM4ECmFpVGPRbYqjUA.320.png 320w, /images/1_yMMvcM4ECmFpVGPRbYqjUA.640.png 640w, /images/1_yMMvcM4ECmFpVGPRbYqjUA.960.png 960w, /images/1_yMMvcM4ECmFpVGPRbYqjUA.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_yMMvcM4ECmFpVGPRbYqjUA.png" alt="I&apos;m using the ::1 address from my /56 subnet as the DNS server &#x2014; i.e., the pfSense router." height="488" width="1000" loading="lazy"></picture></p>
<p>The final step is to configure the <strong>Router Advertisements</strong> section. You&#x2019;ll have noticed that the DHCPv6 configuration doesn&#x2019;t have an option to specify the default gateway &#x2014; IPv6 does away with the concept of static gateways and, using the <a href="https://en.wikipedia.org/wiki/Neighbor_Discovery_Protocol">Neighbor Discovery Protocol</a> (NDP), announces to the network what the router (aka default gateway) is.</p>
<p><picture><source srcset="/images/1_OXaSP4H123fBKGev11y0nQ.320.webp 320w, /images/1_OXaSP4H123fBKGev11y0nQ.640.webp 640w, /images/1_OXaSP4H123fBKGev11y0nQ.960.webp 960w, /images/1_OXaSP4H123fBKGev11y0nQ.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_OXaSP4H123fBKGev11y0nQ.320.png 320w, /images/1_OXaSP4H123fBKGev11y0nQ.640.png 640w, /images/1_OXaSP4H123fBKGev11y0nQ.960.png 960w, /images/1_OXaSP4H123fBKGev11y0nQ.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_OXaSP4H123fBKGev11y0nQ.png" alt="Probably should caption this, eh" height="642" width="1000" loading="lazy"></picture></p>
<p>Lastly, at the bottom of the page, check the checkbox next to <strong>Use same settings as DHCPv6 server</strong>, and click <strong>Save</strong></p>
<p><picture><source srcset="/images/1_DcjQ3vTDFE-k7Q_PAatOPw.320.webp 320w, /images/1_DcjQ3vTDFE-k7Q_PAatOPw.640.webp 640w, /images/1_DcjQ3vTDFE-k7Q_PAatOPw.960.webp 960w, /images/1_DcjQ3vTDFE-k7Q_PAatOPw.1000.webp 1000w" sizes="100vw" type="image/webp"><source srcset="/images/1_DcjQ3vTDFE-k7Q_PAatOPw.320.png 320w, /images/1_DcjQ3vTDFE-k7Q_PAatOPw.640.png 640w, /images/1_DcjQ3vTDFE-k7Q_PAatOPw.960.png 960w, /images/1_DcjQ3vTDFE-k7Q_PAatOPw.1000.png 1000w" sizes="100vw" type="image/png"><img src="/images/1_DcjQ3vTDFE-k7Q_PAatOPw.png" alt="Hey, presto! DHCPv6." height="271" width="1000" loading="lazy"></picture></p>
<p><picture><source srcset="/images/1_F5iT46roUJaBhAOV3fJNjA.510.webp 510w" sizes="100vw" type="image/webp"><source srcset="/images/1_F5iT46roUJaBhAOV3fJNjA.510.png 510w" sizes="100vw" type="image/png"><img src="/images/1_F5iT46roUJaBhAOV3fJNjA.png" alt="Spookyboi numbers" height="161" width="510" loading="lazy"></picture></p>
<hr>
<h2 id="once-again%2C-get-your-firewall-sorted-out">Once again, get your firewall sorted out <a class="anchor-link" href="#once-again%2C-get-your-firewall-sorted-out">#</a></h2>
<p>pfSense has a deny-by-default approach to firewall rules. Unless a rule exists to allow the traffic, it&#x2019;s blocked. This is good!</p>
<p>Unless you&#x2019;ve a really good reason for allowing traffic into your network on the WAN interface, <strong>don&#x2019;t</strong>. Before you get IPv6 configured, take a few seconds to verify you don&#x2019;t have a cheeky &#x201C;allow-all&#x201D; rule on your WAN interface.</p>
<hr>
<h2 id="glossary">Glossary <a class="anchor-link" href="#glossary">#</a></h2>
<p>Someone pointed out that a glossary of terms would be useful. So, Guy, here ya go:</p>
<ul>
<li><a href="https://en.wikipedia.org/wiki/IPv6">IPv6:</a> the 6th version of the Internet Protocol.</li>
<li>ISP: Internet Service Provider. Telstra, Verizon, BT, etc.</li>
<li><a href="https://en.wikipedia.org/wiki/Subnetwork">Subnet mask</a>: a method used to divide an IP address range.</li>
<li><a href="https://en.wikipedia.org/wiki/Network_address_translation">NAT: Network Address Translation</a>. Wot allows millions of 192.168.168.1 home routers to coexist on the internet without it literally erupting into flames.</li>
<li><a href="https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing">/64, /56: Classless Inter-Domain Routing network sizes</a>. A way of expressing the division of IP address ranges into smaller chunks.</li>
<li><a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol">DHCPv6</a>: The IPv6 version of the well-loved Dynamic Host Configuration Protocol. Dynamically issues an IP address to your computer from a larger pool of addresses.</li>
<li><a href="https://en.wikipedia.org/wiki/Link-local_address">Link Local</a>: A method used by IPv4 and IPv6 to self-issue IP addresses in the absence of DHCP or a statically-configured address.</li>
</ul>

              </div>
            </section>
          </article>
        </div>
      </main>

      <aside class="read-next outer"></aside>

      <footer class="site-footer outer">
    <div class="inner">
        <p>The views on this website are entirely my own and do not reflect those of my employer, my country, or the small alien that controls this flesh prison.</p>
        <p>All text copyright &#xA9; Michael Greenhill.</p>
    </div>
</footer>

    </div>
  
</body></html>